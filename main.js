var h=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var f=(s,e)=>{for(var t in e)h(s,t,{get:e[t],enumerable:!0})},g=(s,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of u(e))!m.call(s,n)&&n!==t&&h(s,n,{get:()=>e[n],enumerable:!(a=w(e,n))||a.enumerable});return s};var k=s=>g(h({},"__esModule",{value:!0}),s);var x={};f(x,{default:()=>d});module.exports=k(x);var r=require("obsidian"),d=class extends r.Plugin{async onload(){this.addCommand({id:"open-or-create-link",name:"\u30EA\u30F3\u30AF\u5148\u3092\u958B\u304F / \u5B58\u5728\u3057\u306A\u3051\u308C\u3070\u4F5C\u6210\u3057\u3066\u958B\u304F",editorCallback:(e,t)=>{this.handleLink(t)}})}extractLinkAtCursor(e){let t=e.getCursor(),a=e.getLine(t.line),n=/\[\[([^\]]+)\]\]/g,i;for(;(i=n.exec(a))!==null;){let l=i.index,p=l+i[0].length;if(t.ch>=l&&t.ch<=p){let o=i[1],c=o.indexOf("|");return c>=0?o.substring(0,c):o}}return null}async handleLink(e){let t=e.editor,a=this.extractLinkAtCursor(t);if(!a){new r.Notice("\u30AB\u30FC\u30BD\u30EB\u4F4D\u7F6E\u306B\u30EA\u30F3\u30AF\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let n=e.file;if(!n){new r.Notice("\u73FE\u5728\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093");return}let i=this.app.metadataCache.getFirstLinkpathDest(a,n.path);i?(await this.app.workspace.getLeaf(!1).openFile(i),new r.Notice(`${i.name} \u3092\u958B\u304D\u307E\u3057\u305F`)):await this.createAndOpenFile(a,n)}async createAndOpenFile(e,t){var o,c;let a=(c=(o=t.parent)==null?void 0:o.path)!=null?c:"",n=(0,r.normalizePath)(a?`${a}/${e}.md`:`${e}.md`),l=`---
up:
  - "[[${t.basename}]]"
---
`,p=await this.app.vault.create(n,l);await this.app.workspace.getLeaf(!1).openFile(p),new r.Notice(`${e}.md \u3092\u4F5C\u6210\u3057\u307E\u3057\u305F`)}};
